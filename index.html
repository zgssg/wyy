<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>网易云会员领取</title>
  <link rel="icon" href="https://p3-pc.douyinpic.com/img/aweme-avatar/tos-cn-i-0813_oIaLi1chgT0eAEmb0AIA1XiyA7AMDmfyCHAdBA~c5_300x300.jpeg?from=2956013662">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="button-container">
    <p style="text-align: center">更新时间：2026年1月6日</p>
    <button class="btn" data-url="https://163cn.tv/Y8H9dwt">黑胶会员</button>
    <p style="text-align: center"></p>
    <button class="btn" data-url="URL">无</button>
    <p style="text-align: center"></p>
    <button class="btn" data-url="URL">无</button>
    <p style="text-align: center"></p>
    <button class="btn" data-url="URL">无</button>
    <p style="text-align: center"></p>
    <button class="btn" data-url="URL">无</button>
    <footer>
      -此项目由抖音<a href="https://v.douyin.com/H_WKh3r25Zw/" target="_blank" id="douyinLink">@yu</a>提供服务-
    </footer>
  </div>

  <script>
    // 检测QQ和微信浏览器
    window.onload = function() {
      const userAgent = navigator.userAgent.toLowerCase();
      // 更精确地检测QQ浏览器
      const isQQBrowser = /mqqbrowser|qqbrowser/i.test(userAgent) || (/qq/i.test(userAgent) && !/micromessenger/i.test(userAgent));
      const isWechat = /micromessenger/i.test(userAgent);
      
      if (isWechat || isQQBrowser) {
        // 使用更可靠的方式显示弹窗
        setTimeout(function() {
          alert('检测到您正在使用' + (isWechat ? '微信' : 'QQ') + '内置浏览器，为了更好的体验，请使用系统浏览器打开本页面。');
        }, 300);
      }
    };
    
    // 处理抖音链接点击事件
    document.getElementById('douyinLink').addEventListener('click', function(e) {
      e.preventDefault();
      
      const link = this.getAttribute('href');
      const packageName = 'com.ss.android.ugc.aweme';
      
      const userAgent = navigator.userAgent.toLowerCase();
      let appUrl;
      
      if (userAgent.indexOf('android') > -1) {
        appUrl = `intent://${new URL(link).host}${new URL(link).pathname}?${new URL(link).search.substring(1)}#Intent;scheme=${new URL(link).protocol.replace(':', '')};package=${packageName};end`;
      } else if (userAgent.indexOf('iphone') > -1 || userAgent.indexOf('ipad') > -1 || userAgent.indexOf('ipod') > -1) {
        appUrl = `snssdk1128://${new URL(link).host}${new URL(link).pathname}?${new URL(link).search.substring(1)}`;
      } else {
        appUrl = link;
      }
      
      window.location.href = appUrl;
      
      setTimeout(function() {
        alert('正在尝试打开抖音应用，如果应用没有自动打开，请检查浏览器设置或手动打开应用。');
      }, 1000);
      
      setTimeout(function() {
        if (document.visibilityState === 'visible') {
          console.log('应用打开失败，正在打开网站链接...');
          window.location.href = link;
        }
      }, 3000);
    });
    
    document.querySelectorAll('.btn').forEach(function(button) {
      button.addEventListener('click', function(e) {
        e.preventDefault();
        
        const link = this.getAttribute('data-url');
        
        const packageName = 'com.netease.cloudmusic';
        
        const userAgent = navigator.userAgent.toLowerCase();
        let appUrl;
        
        if (userAgent.indexOf('android') > -1) {
          appUrl = `intent://${new URL(link).host}${new URL(link).pathname}?${new URL(link).search.substring(1)}#Intent;scheme=${new URL(link).protocol.replace(':', '')};package=${packageName};end`;
        } else if (userAgent.indexOf('iphone') > -1 || userAgent.indexOf('ipad') > -1 || userAgent.indexOf('ipod') > -1) {
          appUrl = `orpheus://${new URL(link).host}${new URL(link).pathname}?${new URL(link).search.substring(1)}`;
        } else {
          appUrl = link;
        }
        
        const startTime = new Date().getTime();
        
        window.location.href = appUrl;
        
        setTimeout(function() {
          alert('正在尝试打开网易云音乐应用，如果应用没有自动打开，请检查浏览器设置或手动打开应用。');
        }, 1000);
        
        setTimeout(function() {
          if (document.visibilityState === 'visible') {
            console.log('应用打开失败，正在打开网站链接...');
            window.location.href = link;
          }
        }, 3000);
      });
    });  <!-- 这里是新增的 “});” ，用于正确关闭 forEach 的回调 -->
    document.addEventListener('DOMContentLoaded', async function () {
        const url = 'https://bdyx.ct.ws/api.php?nr=wyy';
        try {
            const res = await fetch(url, { method: 'GET' });
    
            if (!res.ok) {
                console.warn('API 请求失败：HTTP 状态码', res.status);
                return;
            }
    
            // 尝试按 JSON 解析并判断 message
            let data;
            const contentType = res.headers.get('content-type') || '';
            try {
                data = contentType.includes('application/json') ? await res.json() : JSON.parse(await res.text());
            } catch (parseErr) {
                console.warn('API 返回内容无法解析为 JSON，视为失败：', parseErr);
                return;
            }
    
            if (data && data.message === '请求已处理') {
                console.log('API 请求成功：message 为 "请求已处理"。完整数据：', data);
            } else {
                console.warn('API 请求失败：message 不为 "请求已处理"。完整数据：', data);
            }
        } catch (err) {
            console.error('API 请求异常，视为失败：', err);
        }
    });
</script>
</body>
</html>
